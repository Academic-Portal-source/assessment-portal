<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Portal</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Crimson+Pro:wght@600;700&display=swap');
        :root { --brand-navy: #0f172a; }
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .serif-title { font-family: 'Crimson Pro', serif; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="text-slate-900">
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, onSnapshot, addDoc, deleteDoc, updateDoc, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase Config from previous successful environment
        const firebaseConfig = {
            apiKey: "AIzaSyALMgvcCfYCQVBZy3Kxv0r6vUx_gyoqYGg",
            authDomain: "assessment-portal-27ad3.firebaseapp.com",
            projectId: "assessment-portal-27ad3",
            storageBucket: "assessment-portal-27ad3.firebasestorage.app",
            messagingSenderId: "539434351950",
            appId: "1:539434351950:web:c9a68dc8003d3f83d1f21f"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Export to window for React component access
        window.FB = { auth, db, collection, doc, setDoc, getDoc, onSnapshot, addDoc, deleteDoc, updateDoc, query, signInAnonymously, onAuthStateChanged };
        window.__app_id = "assessment-portal-27ad3";
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const ADMIN_PASS = "admin123";
        const CLASS_OPTIONS = ["1", "2", "3", "4", "5", "6", "7"];

        function App() {
            const [view, setView] = useState('login');
            const [user, setUser] = useState(null);
            const [admissionNo, setAdmissionNo] = useState('');
            const [studentClass, setStudentClass] = useState('');
            const [questions, setQuestions] = useState([]);
            const [modules, setModules] = useState([]);
            const [submissions, setSubmissions] = useState([]);
            const [studentRoster, setStudentRoster] = useState([]);
            const [activeModule, setActiveModule] = useState(null);
            const [adminPassInput, setAdminPassInput] = useState('');
            const [loading, setLoading] = useState(false);

            const appId = window.__app_id || 'default-app';

            // Auth Effect
            useEffect(() => {
                const { auth, signInAnonymously, onAuthStateChanged } = window.FB;
                signInAnonymously(auth).catch(console.error);
                const unsubscribe = onAuthStateChanged(auth, (u) => {
                    if (u) setUser(u);
                });
                return () => unsubscribe();
            }, []);

            // Data Subscription Effect
            useEffect(() => {
                if (!user) return;
                const { db, collection, onSnapshot } = window.FB;

                // Using standard paths to ensure data persistence
                const qRef = collection(db, 'artifacts', appId, 'public', 'data', 'questions');
                const mRef = collection(db, 'artifacts', appId, 'public', 'data', 'modules');
                const sRef = collection(db, 'artifacts', appId, 'public', 'data', 'submissions');
                const rRef = collection(db, 'artifacts', appId, 'public', 'data', 'roster');

                const unsubs = [
                    onSnapshot(qRef, s => setQuestions(s.docs.map(d => ({id:d.id, ...d.data()}))), e => console.error("Q Error", e)),
                    onSnapshot(mRef, s => setModules(s.docs.map(d => ({id:d.id, ...d.data()}))), e => console.error("M Error", e)),
                    onSnapshot(sRef, s => setSubmissions(s.docs.map(d => ({id:d.id, ...d.data()}))), e => console.error("S Error", e)),
                    onSnapshot(rRef, s => setStudentRoster(s.docs.map(d => ({id:d.id, ...d.data()}))), e => console.error("R Error", e))
                ];

                return () => unsubs.forEach(fn => fn());
            }, [user, appId]);

            const filteredQuestions = questions.filter(q => q.targetClass === studentClass);
            const filteredModules = modules.filter(m => m.targetClass === studentClass);

            const enterPortal = () => {
                if(!admissionNo) return;
                setLoading(true);
                const student = studentRoster.find(s => s.admissionNo.toUpperCase() === admissionNo.toUpperCase());
                
                setTimeout(() => {
                    if (student) {
                        setStudentClass(student.studentClass);
                        setView('dashboard');
                    } else {
                        alert("Academic records not found for: " + admissionNo);
                    }
                    setLoading(false);
                }, 800);
            };

            const handleLogout = () => {
                setView('login');
                setAdmissionNo('');
                setStudentClass('');
                setActiveModule(null);
            };

            return (
                <div className="min-h-screen flex flex-col font-sans bg-slate-50">
                    <nav className="bg-white border-b border-slate-200 px-6 py-4 flex justify-between items-center sticky top-0 z-50 shadow-sm">
                        <div className="flex items-center gap-4 cursor-pointer" onClick={() => (view !== 'quiz' && view !== 'external') && setView('login')}>
                            <div className="bg-slate-900 p-2 rounded shadow-sm">
                                <svg className="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>
                            </div>
                            <h1 className="text-xs font-black tracking-widest text-slate-900 uppercase">Academic Portal</h1>
                        </div>
                        {view !== 'login' && view !== 'admin-login' && (
                            <button onClick={handleLogout} className="px-4 py-2 border border-slate-200 rounded-lg text-[10px] font-bold text-slate-500 hover:bg-red-50 hover:text-red-600 transition-all uppercase tracking-widest">Sign Out</button>
                        )}
                    </nav>

                    <main className="flex-1 flex flex-col p-4 md:p-8 max-w-6xl mx-auto w-full">
                        {view === 'login' && (
                            <div className="max-w-md w-full mx-auto my-auto space-y-8 animate-in fade-in slide-in-from-bottom-4">
                                <div className="text-center space-y-2">
                                    <h2 className="serif-title text-5xl text-slate-900">Student Entry</h2>
                                </div>
                                <div className="bg-white p-10 rounded-2xl border border-slate-200 shadow-2xl">
                                    <div className="space-y-6 text-center">
                                        <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-3 block">Institutional ID</label>
                                        <input className="w-full bg-slate-50 border border-slate-200 p-5 rounded-xl outline-none font-bold text-xl text-center uppercase" placeholder="ADM-000" value={admissionNo} onChange={e => setAdmissionNo(e.target.value)} onKeyDown={e => e.key === 'Enter' && enterPortal()}/>
                                        <button onClick={enterPortal} disabled={loading} className="w-full bg-slate-900 text-white py-5 rounded-xl font-bold uppercase tracking-widest text-xs">{loading ? 'Searching...' : 'Enter Portal'}</button>
                                        <button onClick={() => setView('admin-login')} className="text-[10px] font-bold text-slate-300 hover:text-slate-900 uppercase tracking-widest">Staff Access</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === 'admin-login' && (
                            <div className="max-w-md w-full mx-auto my-auto bg-white p-10 rounded-2xl border border-slate-200 shadow-2xl">
                                <h2 className="serif-title text-3xl text-center mb-8">Faculty Entry</h2>
                                <input type="password" className="w-full bg-slate-50 p-4 rounded-xl border border-slate-200 text-center font-bold mb-4" placeholder="Access Key" value={adminPassInput} onChange={e => setAdminPassInput(e.target.value)}/>
                                <button onClick={() => adminPassInput === ADMIN_PASS ? setView('admin-dashboard') : alert('Denied')} className="w-full bg-slate-900 text-white py-4 rounded-xl font-bold uppercase text-[10px] tracking-widest">Authorize</button>
                                <button onClick={() => setView('login')} className="w-full text-slate-400 font-bold text-[10px] uppercase tracking-widest mt-4">Cancel</button>
                            </div>
                        )}

                        {view === 'dashboard' && (
                            <div className="animate-in fade-in">
                                <div className="mb-8 border-b pb-8 flex flex-col md:flex-row md:items-end justify-between gap-4">
                                    <div>
                                        <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Student Dashboard</p>
                                        <h2 className="serif-title text-5xl text-slate-900">Welcome, {admissionNo}</h2>
                                    </div>
                                    <div className="bg-slate-900 text-white px-4 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest">
                                        Level {studentClass}
                                    </div>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    <div className="bg-white p-8 rounded-2xl border border-slate-200 hover:border-slate-900 transition-all cursor-pointer group flex flex-col justify-between h-64" onClick={() => setView('quiz')}>
                                        <div>
                                            <div className="w-10 h-10 bg-slate-900 text-white rounded-lg flex items-center justify-center mb-6">
                                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                                            </div>
                                            <h3 className="text-lg font-bold text-slate-900 uppercase">Curriculum Assessment</h3>
                                            <p className="text-slate-500 text-xs mt-3">Formal examination based on current learning goals.</p>
                                        </div>
                                        <div className="flex items-center text-slate-900 font-bold text-[10px] uppercase">Begin Exam →</div>
                                    </div>
                                    {filteredModules.map(m => (
                                        <div key={m.id} className="bg-white p-8 rounded-2xl border border-slate-200 hover:border-slate-900 transition-all cursor-pointer group flex flex-col justify-between h-64" onClick={() => { setActiveModule(m); setView('external'); }}>
                                            <div>
                                                <div className="w-10 h-10 bg-blue-600 text-white rounded-lg flex items-center justify-center mb-6">
                                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" /></svg>
                                                </div>
                                                <h3 className="text-lg font-bold text-slate-900 uppercase truncate">{m.name}</h3>
                                                <p className="text-slate-500 text-xs mt-3">Interactive learning unit.</p>
                                            </div>
                                            <div className="flex items-center text-blue-600 font-bold text-[10px] uppercase">Launch Module →</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {view === 'quiz' && (
                            <QuizEngine 
                                questions={filteredQuestions} 
                                admissionNo={admissionNo} 
                                studentClass={studentClass} 
                                appId={appId}
                                onComplete={() => setView('success')}
                                onBack={() => setView('dashboard')}
                            />
                        )}

                        {view === 'external' && activeModule && (
                            <div className="fixed inset-0 z-[100] bg-slate-900 flex flex-col">
                                <div className="p-4 bg-white/5 backdrop-blur-md border-b border-white/10 flex justify-between items-center px-6">
                                    <button onClick={() => setView('dashboard')} className="flex items-center gap-3 px-4 py-2 bg-white/10 text-white rounded-lg hover:bg-white/20 transition-all">
                                        <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
                                        <span className="text-[10px] font-bold uppercase tracking-widest">Exit</span>
                                    </button>
                                    <h2 className="text-xs font-bold text-white uppercase tracking-widest">{activeModule.name}</h2>
                                    <div className="w-24"></div>
                                </div>
                                <div className="flex-1 p-2 bg-slate-900">
                                    <iframe srcDoc={activeModule.html} className="w-full h-full bg-white rounded-2xl" sandbox="allow-scripts" />
                                </div>
                            </div>
                        )}

                        {view === 'success' && (
                            <div className="max-w-xl mx-auto my-auto text-center bg-white p-12 rounded-3xl border border-slate-200 shadow-2xl">
                                <div className="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-8 font-black">✓</div>
                                <h2 className="serif-title text-4xl mb-4 text-slate-900">Exam Finalized</h2>
                                <p className="text-slate-500 mb-10 text-sm uppercase font-bold tracking-widest">Assessment completed for {admissionNo}.</p>
                                <button onClick={() => setView('login')} className="w-full bg-slate-900 text-white py-4 rounded-xl font-bold uppercase text-[10px] tracking-widest">Sign Out</button>
                            </div>
                        )}

                        {view === 'admin-dashboard' && <AdminPanel submissions={submissions} questions={questions} modules={modules} roster={studentRoster} appId={appId} onBack={() => setView('login')} />}
                    </main>
                </div>
            );
        }

        function QuizEngine({ questions, admissionNo, studentClass, appId, onComplete, onBack }) {
            const [idx, setIdx] = useState(0);
            const [ans, setAns] = useState({});
            const start = useRef(Date.now());

            const finish = async () => {
                const score = questions.filter((q, i) => (ans[i]||'').toLowerCase().trim() === (q.correct||'').toLowerCase().trim()).length;
                const { db, collection, addDoc } = window.FB;
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'submissions'), {
                    admissionNo, studentClass, score: `${score}/${questions.length}`,
                    completedAt: Date.now(), timeSpent: Math.round((Date.now() - start.current)/1000)
                });
                onComplete();
            };

            const q = questions[idx];
            if(!q) return <div className="text-center py-20 font-black text-slate-300 uppercase text-xs">No questions assigned.</div>;

            return (
                <div className="max-w-3xl mx-auto w-full">
                    <div className="mb-6 flex justify-between items-center px-2">
                        <button onClick={onBack} className="flex items-center gap-2 px-4 py-2 rounded-lg bg-white border border-slate-200 text-slate-500 hover:text-slate-900 transition-all shadow-sm">
                            <span className="text-[10px] font-black uppercase tracking-widest">← Exit to Dashboard</span>
                        </button>
                        <div className="text-[10px] font-black text-slate-400 uppercase tracking-widest">{idx + 1} / {questions.length}</div>
                    </div>

                    <div className="bg-white p-8 md:p-12 rounded-3xl border border-slate-200 shadow-xl relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-full h-1.5 bg-slate-50">
                            <div className="h-full bg-slate-900 transition-all duration-700" style={{width: `${((idx+1)/questions.length)*100}%`}}></div>
                        </div>
                        <h2 className="serif-title text-3xl mb-12 text-slate-900 leading-relaxed">{q.text}</h2>
                        <div className="space-y-3">
                            {q.type === 'mcq' ? (q.options || []).map((o, i) => (
                                <button key={i} onClick={() => setAns({...ans, [idx]: o})} className={`w-full p-5 text-left rounded-xl border-2 transition-all font-bold text-sm flex items-center ${ans[idx] === o ? 'border-slate-900 bg-slate-50' : 'border-slate-100 hover:bg-slate-50'}`}>
                                    <span className={`w-8 h-8 rounded-lg mr-5 flex items-center justify-center text-[10px] font-black ${ans[idx] === o ? 'bg-slate-900 text-white' : 'bg-slate-100 text-slate-300'}`}>{String.fromCharCode(65+i)}</span> 
                                    {o}
                                </button>
                            )) : (
                                <input className="w-full p-6 border-2 border-slate-100 rounded-2xl outline-none text-xl font-bold bg-slate-50" placeholder="Type answer..." value={ans[idx]||''} onChange={e => setAns({...ans, [idx]: e.target.value})} />
                            )}
                        </div>
                        <div className="flex justify-between mt-16 pt-10 border-t">
                            <button disabled={idx===0} onClick={() => setIdx(idx-1)} className="text-slate-300 font-black text-[10px] uppercase tracking-widest disabled:opacity-0">Previous</button>
                            {idx === questions.length - 1 ? 
                                <button onClick={finish} className="bg-slate-900 text-white px-10 py-5 rounded-xl font-bold uppercase text-[10px] tracking-widest shadow-lg">Finish Assessment</button> :
                                <button onClick={() => setIdx(idx+1)} className="bg-slate-900 text-white px-10 py-5 rounded-xl font-bold uppercase text-[10px] tracking-widest">Next</button>
                            }
                        </div>
                    </div>
                </div>
            );
        }

        function AdminPanel({ submissions, questions, modules, roster, appId, onBack }) {
            const [tab, setTab] = useState('results');
            const [newQ, setNewQ] = useState({ text: '', type: 'mcq', options: ['', '', '', ''], correct: '', targetClass: '1' });
            const [newStudent, setNewStudent] = useState({ admissionNo: '', studentClass: '1' });
            const htmlRef = useRef();

            const saveQuestion = async () => {
                if(!newQ.text || !newQ.correct) return alert("Text and Correct Answer required.");
                const { db, collection, addDoc } = window.FB;
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'questions'), {...newQ, options: newQ.options.filter(o => o.trim())});
                setNewQ({ ...newQ, text: '', options: ['', '', '', ''], correct: '' });
            };

            const addStudent = async () => {
                if(!newStudent.admissionNo) return;
                const { db, collection, addDoc } = window.FB;
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'roster'), newStudent);
                setNewStudent({ admissionNo: '', studentClass: '1' });
            };

            const del = async (col, id) => {
                if(confirm('Delete?')) await window.FB.deleteDoc(window.FB.doc(window.FB.db, 'artifacts', appId, 'public', 'data', col, id));
            };

            return (
                <div className="max-w-6xl mx-auto w-full space-y-8 pb-12">
                    <div className="bg-white p-4 rounded-2xl border border-slate-200 flex justify-between items-center overflow-x-auto">
                        <div className="flex bg-slate-50 p-1 rounded-xl whitespace-nowrap">
                            {['results', 'students', 'curriculum', 'modules'].map(t => (
                                <button key={t} onClick={() => setTab(t)} className={`px-6 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest ${tab === t ? 'bg-white shadow-sm text-slate-900' : 'text-slate-400'}`}>{t}</button>
                            ))}
                        </div>
                        <button onClick={onBack} className="text-[10px] font-black text-slate-300 uppercase px-4">Logout</button>
                    </div>

                    {tab === 'results' && (
                        <div className="bg-white rounded-2xl border overflow-hidden shadow-sm">
                            <table className="w-full text-left">
                                <thead className="bg-slate-50 text-[10px] font-black text-slate-400 border-b uppercase">
                                    <tr><th className="p-6">Student</th><th className="p-6 text-center">Class</th><th className="p-6 text-center">Score</th><th className="p-6 text-right">Date</th></tr>
                                </thead>
                                <tbody className="divide-y text-sm">
                                    {submissions.map((s, i) => (
                                        <tr key={i} className="font-medium">
                                            <td className="p-6 font-bold">{s.admissionNo}</td>
                                            <td className="p-6 text-center font-black text-[10px]">Tier {s.studentClass}</td>
                                            <td className="p-6 text-center font-black">{s.score}</td>
                                            <td className="p-6 text-right text-slate-400">{new Date(s.completedAt).toLocaleDateString()}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}

                    {tab === 'students' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <div className="lg:col-span-2 bg-white rounded-2xl border p-6">
                                <h4 className="text-[10px] font-black uppercase text-slate-400 mb-6">Registered Students</h4>
                                <div className="space-y-2">
                                    {roster.map(s => (
                                        <div key={s.id} className="flex justify-between items-center p-4 bg-slate-50 rounded-xl">
                                            <span className="font-bold">{s.admissionNo} (Class {s.studentClass})</span>
                                            <button onClick={() => del('roster', s.id)} className="text-red-300 hover:text-red-600">Delete</button>
                                        </div>
                                    ))}
                                </div>
                            </div>
                            <div className="bg-white p-8 rounded-3xl border h-fit space-y-4">
                                <h3 className="serif-title text-2xl">Enroll Student</h3>
                                <input className="w-full p-4 bg-slate-50 rounded-xl text-xs font-bold" placeholder="Admission ID" value={newStudent.admissionNo} onChange={e => setNewStudent({...newStudent, admissionNo: e.target.value.toUpperCase()})} />
                                <select className="w-full p-4 bg-slate-50 rounded-xl font-bold text-xs" value={newStudent.studentClass} onChange={e => setNewStudent({...newStudent, studentClass: e.target.value})}>
                                    {CLASS_OPTIONS.map(o => <option key={o} value={o}>Class {o}</option>)}
                                </select>
                                <button onClick={addStudent} className="w-full bg-slate-900 text-white py-4 rounded-xl font-bold text-[10px] uppercase">Add Record</button>
                            </div>
                        </div>
                    )}

                    {tab === 'curriculum' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <div className="lg:col-span-2 space-y-3">
                                {questions.map(q => (
                                    <div key={q.id} className="bg-white p-6 rounded-2xl border flex justify-between items-center group">
                                        <div>
                                            <span className="text-[9px] font-black uppercase text-slate-400">Class {q.targetClass}</span>
                                            <p className="font-bold text-slate-800">{q.text}</p>
                                        </div>
                                        <button onClick={() => del('questions', q.id)} className="text-red-300">Delete</button>
                                    </div>
                                ))}
                            </div>
                            <div className="bg-white p-8 rounded-3xl border shadow-lg space-y-4">
                                <h3 className="serif-title text-2xl">Create Question</h3>
                                <select className="w-full p-4 bg-slate-50 rounded-xl font-bold text-xs" value={newQ.targetClass} onChange={e => setNewQ({...newQ, targetClass: e.target.value})}>
                                    {CLASS_OPTIONS.map(opt => <option key={opt} value={opt}>Class {opt}</option>)}
                                </select>
                                <textarea className="w-full p-4 bg-slate-50 rounded-xl text-sm" placeholder="Question Text..." value={newQ.text} onChange={e => setNewQ({...newQ, text: e.target.value})} />
                                <input className="w-full p-4 bg-slate-50 rounded-xl text-xs font-black" placeholder="Correct Answer" value={newQ.correct} onChange={e => setNewQ({...newQ, correct: e.target.value})} />
                                <button onClick={saveQuestion} className="w-full bg-slate-900 text-white py-4 rounded-xl font-bold text-[10px] uppercase">Save Question</button>
                            </div>
                        </div>
                    )}

                    {tab === 'modules' && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <div className="lg:col-span-2 bg-white rounded-2xl border p-6 space-y-2">
                                {modules.map(m => (
                                    <div key={m.id} className="flex justify-between items-center p-4 bg-slate-50 rounded-xl">
                                        <span className="font-bold">{m.name} (Class {m.targetClass})</span>
                                        <button onClick={() => del('modules', m.id)} className="text-red-300">Delete</button>
                                    </div>
                                ))}
                            </div>
                            <div className="bg-white p-8 rounded-3xl border shadow-lg text-center space-y-4">
                                <h3 className="serif-title text-2xl">Upload Module</h3>
                                <button onClick={() => htmlRef.current.click()} className="w-full bg-slate-900 text-white py-4 rounded-xl font-black uppercase text-[10px]">Select HTML</button>
                                <input type="file" ref={htmlRef} className="hidden" accept=".html" onChange={async (e) => {
                                    const file = e.target.files[0];
                                    const reader = new FileReader();
                                    reader.onload = async (ev) => {
                                        await window.FB.addDoc(window.FB.collection(window.FB.db, 'artifacts', appId, 'public', 'data', 'modules'), {
                                            name: file.name, html: ev.target.result,
                                            targetClass: '1', addedAt: Date.now()
                                        });
                                        alert("Module Uploaded");
                                    };
                                    reader.readAsText(file);
                                }} />
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
